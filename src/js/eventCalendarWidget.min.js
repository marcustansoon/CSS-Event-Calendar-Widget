window.Calendar=function(){var e=moment();function t(e,t){this.el=document.querySelector(e);let n=[];for(let e=0,a=t.length;e<a;e++){let a=t[e];if(a.color=a.color||this.getRandomColor(),!a.eventFrom||!a.eventTo){let e=this.getRandomDateRange();a.eventFrom=e.eventFrom,a.eventTo=e.eventTo}a.eventName=a.eventName||this.getRandomEventName();let i=moment(a.eventTo,"YYYY-MM-DD HH:mm:ss").diff(moment(a.eventFrom,"YYYY-MM-DD HH:mm:ss"),"days");for(let e=0;e<=i;e++){let t=JSON.parse(JSON.stringify(a));t.eventTime=moment(a.eventFrom,"YYYY-MM-DD HH:mm:ss").add(e,"days").format("YYYY-MM-DD HH:mm:ss"),n.push(t)}}this.events=n,this.current=moment().date(1),this.draw();var a=document.querySelector(".today");if(a){var i=this;window.setTimeout(function(){i.openDay(a)},500)}}function n(e,t,n){var a=document.createElement(e);return t&&(a.className=t),n&&(a.innderText=a.textContent=n),a}return t.prototype.getRandomColor=function(){let e=["blue","orange","green","yellow","purple","red","lime","aqua","black","coral"];return e[Math.floor(Math.random()*e.length)]},t.prototype.getRandomDateRange=function(){let e=Math.floor(25*Math.random())+1,t=e+Math.floor(4*Math.random())+1,n=Math.floor(19*Math.random())+1,a=n+Math.floor(3*Math.random())+1,i=new Date,r=i.getMonth()+Math.floor(5*Math.random())-2,o=i.getFullYear();return a=a<10?"0"+a:a,{eventFrom:o+"-"+r+"-"+e+" "+(n=n<10?"0"+n:n)+":"+(Math.random()<=.5?"00":"30")+":00",eventTo:o+"-"+r+"-"+t+" "+a+":"+(Math.random()<=.5?"00":"30")+":00"}},t.prototype.getRandomEventName=function(){let e=["Community Garden Workshop","Arts Festival","Gardening","Adam's birthday party","St. Patrick Day","Valentine Day","April Fool's Day","Earth Day","Mother's Day","Father's Day","Memorial Day","Grandma Visit","Doing homework","Doing household chores","Feeding pets","Vacuuming","Doing laundry","Floor sweeping","Surf social media","Studying for exam","Movie theatre","Meeting with old pals","Conference meeting","Group discussion","Interview with Jr. Web Developer","Presentation","Teach Kids to Code","Cooking time","Playing basketball","Playing football","Lunch with families","Lunch with Colleagues","Outings with Mark","Gaming time","Free Tamale Night"];return e[Math.floor(Math.random()*e.length)]},t.prototype.draw=function(){this.drawHeader(),this.drawLegend(),this.drawMonth()},t.prototype.currentYear=function(){return this.current.format("YYYY")},t.prototype.drawHeader=function(){var e=this;if(!this.header){this.header=n("div","header"),this.header.className="header",this.title=n("h1");var t=n("div","right");t.innerHTML='<div style=" padding: 25px; transform: translate(-30px, -25px); "></div>',t.addEventListener("click",function(){e.nextMonth()});var a=n("div","left");a.innerHTML='<div style=" padding: 25px; transform: translate(-20px, -25px); "></div>',a.addEventListener("click",function(){e.prevMonth()}),this.header.appendChild(this.title),this.header.appendChild(t),this.header.appendChild(a),this.el.appendChild(this.header)}this.title.innerHTML=this.current.format("MMMM YYYY")},t.prototype.drawHeader=function(){var e=this;if(!this.header){this.header=n("div","header"),this.header.className="header",this.title=n("h1");var t=n("div","right");t.innerHTML='<div style=" padding: 25px; transform: translate(-30px, -25px); "></div>',t.addEventListener("click",function(){e.nextMonth()});var a=n("div","left");a.innerHTML='<div style=" padding: 25px; transform: translate(-20px, -25px); "></div>',a.addEventListener("click",function(){e.prevMonth()}),this.header.appendChild(this.title),this.header.appendChild(t),this.header.appendChild(a),this.el.appendChild(this.header)}this.title.innerHTML=this.current.format("MMMM YYYY")},t.prototype.drawMonth=function(){var e=this;this.events.forEach(function(e){e.date=moment(e.eventTime,"YYYY-MM-DD hh:mm:ss")}),this.month?(this.oldMonth=this.month,e.next,this.oldMonth.className="month out "+(e.next,"prev"),this.oldMonth.addEventListener("webkitAnimationEnd",function(){e.oldMonth.parentNode.removeChild(e.oldMonth),e.month=n("div","month"),e.backFill(),e.currentMonth(),e.fowardFill(),e.el.appendChild(e.month),window.setTimeout(function(){e.next,e.month.className="month in "+(e.next,"prev")},150)})):(this.month=n("div","month"),this.el.appendChild(this.month),this.backFill(),this.currentMonth(),this.fowardFill(),this.month.className="month new")},t.prototype.backFill=function(){var e=this.current.clone(),t=e.day();if(t){e.subtract("days",t+1);for(var n=t;n>0;n--)this.drawDay(e.add("days",1))}},t.prototype.fowardFill=function(){var e=this.current.clone().add("months",1).subtract("days",1),t=e.day();if(6!==t)for(var n=t;n<6;n++)this.drawDay(e.add("days",1))},t.prototype.currentMonth=function(){for(var e=this.current.clone();e.month()===this.current.month();)this.drawDay(e),e.add("days",1)},t.prototype.getWeek=function(e){this.week&&0!==e.day()||(this.week=n("div","week"),this.month.appendChild(this.week))},t.prototype.drawDay=function(e){var t=this;this.getWeek(e);var a=n("div",this.getDayClass(e));a.addEventListener("click",function(){t.openDay(this)});var i=n("div","day-name",e.format("ddd")),r=n("div","day-number",e.format("DD")),o=n("div","hidden",e.format("MM"));o.setAttribute("month",e.format("MM"));var d=n("div","hidden",e.format("YYYY"));d.setAttribute("year",e.format("YYYY"));var h=n("div","day-events");this.drawEvents(e,h),a.appendChild(i),a.appendChild(r),a.appendChild(o),a.appendChild(d),a.appendChild(h),this.week.appendChild(a)},t.prototype.drawEvents=function(e,t){this.events.reduce(function(t,n){return n.date.isSame(e,"day")&&t.push(n),t},[]).forEach(function(e){var a=n("span",e.color);t.appendChild(a)})},t.prototype.getDayClass=function(t){return classes=["day"],t.month()!==this.current.month()?classes.push("other"):e.isSame(t,"day")&&classes.push("today"),classes.join(" ")},t.prototype.openDay=function(e){let t,a=+e.querySelectorAll(".day-number")[0].innerText||+e.querySelectorAll(".day-number")[0].textContent,i=e.querySelector("[month]").innerHTML,r=e.querySelector("[year]").innerHTML,o=moment(r+"-"+i+"-"+a,"YYYY-MM-DD");var d=document.querySelector(".details");if(d&&d.parentNode===e.parentNode)t=d,h=document.querySelector(".arrow");else{d&&(d.addEventListener("webkitAnimationEnd",function(){d.parentNode.removeChild(d)}),d.addEventListener("oanimationend",function(){d.parentNode.removeChild(d)}),d.addEventListener("msAnimationEnd",function(){d.parentNode.removeChild(d)}),d.addEventListener("animationend",function(){d.parentNode.removeChild(d)}),d.className="details out"),t=n("div","details in");var h=n("div","arrow");t.appendChild(h),e.parentNode.appendChild(t)}var s=this.events.reduce(function(e,t){return t.date.isSame(o,"day")&&t.date.isSame(o,"month")&&t.date.isSame(o,"year")&&e.push(t),e},[]);this.renderEvents(s,t),h.style.left=e.offsetLeft+e.offsetWidth/2+-4-e.parentNode.offsetLeft+"px"},t.prototype.renderEvents=function(e,t){var a=t.querySelector(".events"),i=n("div","events in"+(a?" new":""));if(e.forEach(function(e){let t=n("div","event"),a=n("a"),r=n("div","event-category "+e.color),o=n("span","",e.eventName),d=n("span","time "+e.color,moment(e.eventFrom||0,"YYYY-MM-DD HH:mm:ss").format("hh:mm A")+" - "+moment(e.eventTo||0,"YYYY-MM-DD HH:mm:ss").format("hh:mm A")),h=n("span","location",e.location||"Multi-Purpose Hall");o.style.width="95%",a.href=e.href?e.href:"#",a.appendChild(t),t.appendChild(r),t.appendChild(o),t.appendChild(d),t.innerHTML+="<br>",t.appendChild(h),i.appendChild(a)}),!e.length){var r=n("div","event empty"),o=n("span","","No Events");r.appendChild(o),i.appendChild(r)}a?(a.className="events out",a.addEventListener("webkitAnimationEnd",function(){a.parentNode.removeChild(a),t.appendChild(i)}),a.addEventListener("oanimationend",function(){a.parentNode.removeChild(a),t.appendChild(i)}),a.addEventListener("msAnimationEnd",function(){a.parentNode.removeChild(a),t.appendChild(i)}),a.addEventListener("animationend",function(){a.parentNode.removeChild(a),t.appendChild(i)})):t.appendChild(i)},t.prototype.drawLegend=function(){if(!document.getElementsByClassName("legend").length){var e=n("div","legend new");this.events.map(function(e){return e.calendar+"|"+e.color}).reduce(function(e,t){return-1===e.indexOf(t)&&e.push(t),e},[]).forEach(function(t){var a=t.split("|"),i=n("span","entry "+a[1],a[0]);e.appendChild(i)});this.el.appendChild(e)}},t.prototype.nextMonth=function(){this.current.add("months",1),this.next=!0,this.draw()},t.prototype.prevMonth=function(){this.current.subtract("months",1),this.next=!1,this.draw()},t}();
